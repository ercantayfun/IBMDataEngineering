#5

SELECT 
    dc.country, 
    dcat.category, 
    SUM(fs.amount) AS total_sales
FROM 
    "FactSales" fs
JOIN "DimCountry" dc ON fs.countryid = dc.countryid
JOIN "DimCategory" dcat ON fs.categoryid = dcat.categoryid
GROUP BY GROUPING SETS (
    (dc.country, dcat.category),
    (dc.country),
    (dcat.category),
    ()
)
ORDER BY total_sales DESC, dc.country, dcat.category;


#6

SELECT 
    dd.Year, 
    dc.country, 
    SUM(fs.amount) AS total_sales
FROM 
    "FactSales" fs
JOIN "DimDate" dd ON fs.dateid = dd.dateid
JOIN "DimCountry" dc ON fs.countryid = dc.countryid
GROUP BY ROLLUP (dd.Year, dc.country)
ORDER BY total_sales DESC,dc.country dd.Year;


#7

SELECT 
    dd.Year, 
    dc.country, 
    AVG(fs.amount) AS average_sales
FROM 
    "FactSales" fs
JOIN "DimDate" dd ON fs.dateid = dd.dateid
JOIN "DimCountry" dc ON fs.countryid = dc.countryid
GROUP BY CUBE (dd.Year, dc.country)
ORDER BY dd.Year, dc.country;

#8

CREATE MATERIALIZED VIEW total_sales_per_country AS
SELECT 
    dc.country, 
    SUM(fs.amount) AS total_sales
FROM 
    "FactSales" fs
JOIN "DimCountry" dc ON fs.countryid = dc.countryid
GROUP BY dc.country;

SELECT * FROM total_sales_per_country;


